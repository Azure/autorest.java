// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) TypeSpec Code Generator.

package com.openai;

import com.generic.core.credential.KeyCredential;
import com.openai.models.ChatCompletionRequestMessage;
import com.openai.models.ChatCompletionRequestMessageRole;
import com.openai.models.CreateChatCompletionRequest;
import com.openai.models.CreateChatCompletionRequestModel;
import com.openai.models.CreateChatCompletionResponse;

import java.util.ArrayList;
import java.util.List;

public final class CreateChatCompletion {
    public static void main(String[] args) {
        OpenAIClient openAIClient = new OpenAIClientBuilder()
                .credential(new KeyCredential(System.getenv("OPENAI_API_KEY")))
                .buildClient();

        List<ChatCompletionRequestMessage> messages = new ArrayList<>();
        messages.add(new ChatCompletionRequestMessage(ChatCompletionRequestMessageRole.USER, "Who won the world series in 2020?"));
        messages.add(new ChatCompletionRequestMessage(ChatCompletionRequestMessageRole.USER, "Where was it played?"));


        CreateChatCompletionResponse chatCompletionResponse
                = openAIClient.createChatCompletion(
                        new CreateChatCompletionRequest(CreateChatCompletionRequestModel.GPT_3_5_TURBO, messages));

        System.out.println("Model used for Chat completion: " + chatCompletionResponse.getModel());
        System.out.println("Retrieved the following choices for a chat completion:");

        System.out.println("\nRole\t\tMessage");
        chatCompletionResponse.getChoices().stream()
                .forEach(choice -> System.out.printf("%s\t%s%n", choice.getMessage().getRole(),
                        choice.getMessage().getContent()));


    }
}
